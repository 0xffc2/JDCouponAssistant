"use strict";var r=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function r(a,c,s){function d(t,e){if(!c[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=c[t]={exports:{}};a[t][0].call(i.exports,function(e){return d(a[t][1][e]||e)},i,i.exports,r,a,c,s)}return c[t].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)d(s[e]);return d}({1:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=(r(i,[{key:"get",value:function(){this.couponList=[];for(var e=window.__react_data__.activityData.floorList,t=0;t<e.length;t++){var n=e[t];if("free_coupon"==n.template||"finance_coupon"==n.template)for(var o=0;o<n.couponList.length;o++){var i=n.couponList[o],r=i.scene,a=i.args||i.cpId,c=i.jsonSrv?JSON.parse(i.jsonSrv).cid:"",s=i.discount,d=i.picUrl||i.picture,l=i.status,u=i.limit+","+i.scope;this.couponList.push({discount:s,details:u,scene:r,args:a,status:l,couponbatch:c,picUrl:d})}}this.list()}},{key:"list",value:function(){var e=document.createElement("div");e.innerHTML="<h3 style='border-bottom: 1px solid #2196F3;display: inline-block;margin-top: 5px;padding: 0 37.5vw 5px;'>优惠券</h3>",e.setAttribute("style","display:flex;flex-direction:column;padding: 5px;margin-top: 5px;border: 1px solid #000;");for(var t=0;t<this.couponList.length;t++){var n=this.couponList[t],o=document.createElement("div");o.setAttribute("style","display:flex;flex-direction:row;padding:10px 0;border-bottom:1px solid #999"),"1"==n.scene?o.innerHTML='<img style="width:120px;height:100%;padding-right:10vw;display: block;" src="'+n.picUrl+'" />\n                <div>\n                    <p style="margin-bottom:10px">状态：'+("0"==n.status?"可领取":"1"==n.status?"已领取":"已领光")+"<br/>说明："+n.details+'</p>\n                    <button style="width: 80px;height:30px;background-color: #2196F3;border-radius: 5px;border: 0;">\n                        <a href=\'https://so.m.jd.com/list/couponSearch.action?couponbatch='+n.couponbatch+'\' target="_blank" style="color: #fff;text-decoration: none;">可用商品</a>\n                    </button>\n                    <button style="width: 80px;height:30px;background-color: #2196F3;border-radius: 5px;border: 0;">\n                        <a href=\'https://api.m.jd.com/client.action?functionId=newBabelAwardCollection&body={"activityId":"'+this.couponParams.activityId+'","scene":'+n.scene+',"args":"'+n.args+'"}&client=wh5\' target="_blank" style="color: #fff;text-decoration: none;">直接领取</a>\n                    </button>\n                </div>':"3"==n.scene&&(o.innerHTML='<img style="width:120px;height:100%;padding-right:10vw;display: block;" src="'+n.picUrl+'" />\n                <div>\n                <p style="margin-bottom:10px">状态：'+("0"==n.status?"可领取":"1"==n.status?"已领取":"已领光")+'</p>\n                <button style="width: 80px;height:30px;background-color: #2196F3;border-radius: 5px;border: 0;">\n                    <a href=\'https://api.m.jd.com/client.action?functionId=newBabelAwardCollection&body={"activityId":"'+this.couponParams.activityId+'","scene":'+n.scene+',"actKey":"'+n.args+'"}&client=wh5\' target="_blank" style="color: #fff;text-decoration: none;">直接领取</a>\n                </button>\n                </div>'),e.appendChild(o)}this.container.appendChild(e)}},{key:"send",value:function(o){var i=this;o.style.display="block";for(var e=function(t){var e=i.couponList[t],n="";"1"==e.scene?n='https://api.m.jd.com/client.action?functionId=newBabelAwardCollection&body={"activityId":"'+i.couponParams.activityId+'","scene":'+e.scene+',"args":"'+e.args+'"}&client=wh5':"3"==e.scene&&(n='https://api.m.jd.com/client.action?functionId=newBabelAwardCollection&body={"activityId":"'+i.couponParams.activityId+'","scene":'+e.scene+',"actKey":"'+e.args+'"}&client=wh5'),fetch(n,{credentials:"include"}).then(function(e){return e.json()}).then(function(e){e.errmsg?o.value="第"+(t+1)+"张 领券结果:"+e.errmsg+"\n"+o.value:o.value="第"+(t+1)+"张 领券结果:"+e.subCodeMsg+"\n"+o.value})},t=0;t<this.couponList.length;t++)e(t)}}]),i);function i(e,t){a(this,i),this.url="https://api.m.jd.com/client.action?functionId=newBabelAwardCollection",this.couponList=[],this.couponParams=e,this.container=t}n.default=o},{}],2:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=(r(i,[{key:"get",value:function(){var n=this;this.couponList=[];var e=this.detailurl.replace("{couponBusinessId}",this.couponParams.couponBusinessId);fetch(e).then(function(e){return e.json()}).then(function(e){var t=JSON.parse(e.data).baiCouponInfo;e.isSuccess?(n.couponList.push({couponBusinessId:JSON.parse(e.data).baiCouponDetailsNext.couponBusinessId,platform:t.platform,title:t.title,detail:t.detail}),n.list()):alert("请检查该页面优惠券的有效性！")})}},{key:"list",value:function(){var e=document.createElement("div");e.innerHTML="<h3 style='border-bottom: 1px solid #2196F3;display: inline-block;margin-top: 5px;padding: 0 37.5vw 5px;'>优惠券</h3>",e.setAttribute("style","display:flex;flex-direction:column;padding: 5px;margin-top: 5px;border: 1px solid #000;");for(var t=0;t<this.couponList.length;t++){var n=this.couponList[t],o=document.createElement("div");o.setAttribute("style","padding:10px 0;border-bottom:1px solid #999"),o.innerHTML="<h3>"+n.title+"</h3><p>"+n.detail+"</p><p>可用范围："+n.platform+'</p>\n                                <button style="width: 80px;height:30px;background-color: #2196F3;border-radius: 5px;border: 0;">\n                                    <a href=\'http://opencredit.jd.com/act/get/coupon?couponBusinessId='+n.couponBusinessId+'&actId=004\' target="_blank" style="color: #fff;text-decoration: none;">直接领取</a>\n                                </button>',e.appendChild(o)}this.container.appendChild(e)}},{key:"send",value:function(o){var i=this;o.style.display="block";for(var e=function(t){var e=i.couponList[t],n=i.url.replace("{couponBusinessId}",e.couponBusinessId);fetch(n).then(function(e){return e.json()}).then(function(e){e.isSuccess?o.value="第"+(t+1)+"张 领券结果:领取成功！}\n"+o.value:o.value="第"+(t+1)+"张 领券结果:领取失败！\n"+o.value})},t=0;t<this.couponList.length;t++)e(t)}}]),i);function i(e,t){a(this,i),this.url="https://opencredit.jd.com/act/get/coupon?couponBusinessId={couponBusinessId}&actId=004",this.detailurl="http://opencredit.jd.com/act/get/couponInfo?couponBusinessId={couponBusinessId}",this.couponList=[],this.couponParams=e,this.container=t}n.default=o},{}],3:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var o,i,r=e("./coupons/newBabelAwardCollection"),a=e("./utils/utils"),c=e("./coupons/whtieCoupon");(i=o=o||{})[i.none=0]="none",i[i.receiveCoupons=1]="receiveCoupons",i.newBabelAwardCollection="newBabelAwardCollection",i.whiteCoupon="whiteCoupon";var s=void 0,d=window.location.href,l=!1,u=0,p=500,h=window.setInterval(j,p),f=void 0,b=void 0,m=document.createElement("div"),v=document.createElement("div"),g=document.createElement("div"),y=document.createElement("div"),w=document.createElement("input"),x=document.createElement("button"),k=document.createElement("div"),L=document.createElement("input"),I=document.createElement("div"),C=document.createElement("button"),A=document.createElement("button"),M=document.createElement("textarea"),_=document.createElement("div"),B=document.createElement("div");var E;function j(){fetch("https://api.m.jd.com/client.action?functionId=babelActivityGetShareInfo&client=wh5").then(function(e){return e.json()}).then(function(e){f=a.default.formatDate(e.time),b=new Date(+e.time).toLocaleString()+":"+f.substr(-3,3),g.innerHTML="京东时间："+b+"<br/>当前获取时间的间隔频率："+p+"毫秒",l&&u<=+f&&(M.value+="当前时间："+b+"\n",l=!l,s&&s.send(M))})}Object.assign(window,{getLoginMsg:function(e){e.base.nickname&&(B.innerHTML="当前帐号："+e.base.nickname)}}),function(e){var t={};switch(e){case o.none:break;case o.newBabelAwardCollection:t=d.match(/active\/(\S*)\/index/)[1],s=new r.default({activityId:t},m);break;case o.whiteCoupon:t=a.default.GetQueryString("couponBusinessId"),s=new c.default({couponBusinessId:t},m)}s&&(document.body.innerHTML="",document.body.style.backgroundColor="#ffffff",document.body.style.textAlign="center",m.setAttribute("style","border: 1px solid #000;padding: 5px;margin: 5px;"),v.innerHTML='<h2>京东领券助手V0.1</h2>\n                        <h3>author:krapnik</h3>\n                        <div style="display: flex;flex-direction: row;justify-content: center;">\n                        <iframe src="https://ghbtns.com/github-btn.html?user=krapnikkk&repo=JDCouponAssistant&type=star&count=true" frameborder="0" scrolling="0" width="80px" height="21px"></iframe>\n                        <a href="tencent://message/?uin=708873725Menu=yes" target="_blank" title="发起QQ聊天"><img src="http://bizapp.qq.com/webimg/01_online.gif" alt="QQ" style="margin:0px;"></a>\n                        </div>',_.setAttribute("style","border: 1px solid #000;"),_.innerHTML="<h3 style='border-bottom: 1px solid #2196F3;display: inline-block;margin: 5px;padding: 0 37.5vw 5px;'>操作区</h3>",B.innerHTML="当前帐号：未登录",w.type="text",w.placeholder="请输入获取时间的刷新频率【毫秒】",w.setAttribute("style","width:80vw;height: 25px;border: solid 1px #000;border-radius: 5px;margin: 10px auto;display: block;"),x.innerHTML="重置频率",x.setAttribute("style","width: 80px;height:30px;background-color: #2196F3;border-radius: 5px;border: 0;color:#fff;"),x.addEventListener("click",function(){var e=Math.trunc(+w.value);if(!p)return alert("请检查输入的刷新频率是否有误！(只能为大于0的数字)"),!1;p=e,window.clearInterval(h),h=window.setInterval(j,p)}),L.type="text",L.placeholder="定时领券时间【格式:9:59:59:950】",L.setAttribute("style","width:80vw;height: 25px;border: solid 1px #000;border-radius: 5px;margin: 10px;"),A.innerHTML="定时全部领取",A.addEventListener("click",function(){var e=a.default.formateTime(L.value);if(!e||e<0)return alert("请检查定时领券时间的格式是否有误！"),!1;l=!l,u=e,L.disabled=l,A.innerHTML=l?"取消全部领取":"定时全部领取"}),C.addEventListener("click",function(){s&&s.send(M)}),A.setAttribute("style","width: 120px;height:30px;background-color: #2196F3;border-radius: 5px;border: 0;color:#fff;margin:5px;"),C.innerHTML="一键全部领取",C.setAttribute("style","width: 120px;height:30px;background-color: #2196F3;border-radius: 5px;border: 0;color:#fff;margin:5px;"),M.setAttribute("style","width: 90vw;height: 40vw;border: 1px solid #868686;border-radius: 10px;overflow-y: scroll;margin:5px auto;display:none"),M.setAttribute("disabled","disabled"),document.body.append(m),m.append(v),m.append(_),_.append(B),_.append(y),y.append(g),y.append(w),y.append(x),_.append(k),k.append(L),k.append(I),I.append(C),I.append(A),_.append(M),a.default.createJsonp("getLoginMsg"),s.get())}((E=o.none,window.location.host.includes("jd.com")&&(window.__react_data__?E=o.newBabelAwardCollection:window.Queries&&(E=o.whiteCoupon)),E)),console.clear(),window.console&&(console.group("%c京东领券助手","color:#009a61; font-size: 28px; font-weight: 200"),console.log("%c本插件仅供学习交流使用\n作者:krapnik \ngithub:https://github.com/krapnikkk/JDCouponAssistant","color:#009a61"),console.groupEnd())},{"./coupons/newBabelAwardCollection":1,"./coupons/whtieCoupon":2,"./utils/utils":4}],4:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=(r(i,null,[{key:"formateDate",value:function(e){var t=new Date(+e),n=t.getHours(),o=t.getMinutes(),i=t.getSeconds(),r=t.getMilliseconds();return n<10&&(n="0"+n),o<10&&(o="0"+o),i<10&&(i="0"+i),r<10?r="00"+r:r<100&&10<=r&&(r="0"+r),n+""+o+i+r}},{key:"obtainLocal",value:function(e){return e.replace(/(?:(?:^|.*;\s*)3AB9D23F7A4B3C9B\s*=\s*([^;]*).*$)|^.*$/,"$1")}},{key:"getCookie",value:function(){return document.cookie}},{key:"formatDate",value:function(e){var t=new Date(+e),n=t.getHours(),o=t.getMinutes(),i=t.getSeconds(),r=t.getMilliseconds();return n<10&&(n="0"+n),o<10&&(o="0"+o),i<10&&(i="0"+i),r<10?r="00"+r:r<100&&10<=r&&(r="0"+r),n+""+o+i+r}},{key:"GetQueryString",value:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n?n[2]:""}},{key:"formateTime",value:function(e){return Math.trunc(+e.replace(/[:|：]+/gi,""))}},{key:"createJsonp",value:function(e){var t=document.createElement("script");document.getElementsByTagName("head")[0].appendChild(t),t.setAttribute("src","https://wq.jd.com/user/info/QueryJDUserInfo?sceneid=11110&sceneval=2&g_login_type=1&callback="+e)}}]),i);function i(){a(this,i)}n.default=o},{}]},{},[3]);